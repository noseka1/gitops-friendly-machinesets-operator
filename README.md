# GitOps-Friendly MachineSets Operator

This operator allows the user to manage MachineSets without the need to supply the cluster-specific infrastructure name. Infrastructure name is unique to the OpenShift cluster. It is generated by the OpenShift installer and is not known prior to the cluster installation. This operator injects the infrastructure name into MachineSets automatically.

## Building Container Images (Optional)

This section provides instructions for building your custom operator images. If you'd like to deploy the operator using pre-built images, you can continue to the next section.

Set the version you want to build. See `git tag` for available versions:

```
$ VERSION=0.1.0
```

Check out the tag:

```
$ git checkout $VERSION
```

Set the custom image names. Replace the image names below with your own:

```
$ IMG=quay.io/noseka1/gitops-friendly-machinesets-operator:$VERSION
$ IMAGE_TAG_BASE=quay.io/noseka1/gitops-friendly-machinesets-operator
```

Build operator image:

```
$ make docker-build IMG=$IMG
```

Push the finished operator image to the image registry:

```
$ podman push $IMG
```

Generate operator bundle artifacts:

```
$ make bundle IMG=$IMG CHANNELS=stable DEFAULT_CHANNEL=stable
```

Build bundle container image:

```
$ make bundle-build IMAGE_TAG_BASE=$IMAGE_TAG_BASE
```

Push bundle image to registry:

```
$ podman push $IMAGE_TAG_BASE-bundle:v$VERSION
```

Build catalog container image:

```
$ make catalog-build IMAGE_TAG_BASE=$IMAGE_TAG_BASE
```

Push catalog image to registry:

```
$ podman push $IMAGE_TAG_BASE-catalog:v$VERSION
```

## Deploying the Operator

If you'd like to deploy the operator using your custom built images, substitute the name of your catalog image in `deploy/gitops-friendly-machinesets-catsrc.yaml`:

```
$ sed -i "s#image:.*#image: $IMAGE_TAG_BASE-catalog:v$VERSION#" deploy/gitops-friendly-machinesets-catsrc.yaml
```

Alternatively, you can leverage the pre-built operator images to deploy the operator:

```
$ sed -i "s#image:.*#image: quay.io/noseka1/gitops-friendly-machinesets-operator-catalog:v0.1.0#" deploy/gitops-friendly-machinesets-catsrc.yaml
```

Deploy the operator:

```
$ oc apply -k deploy
```
